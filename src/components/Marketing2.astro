---
import { renderImg } from "astro-imagetools/api";
import Testimonials from "./Testimonials.vue";
import { Testimonial } from "@typescript/Testimonials";

const testimonialsData: Testimonial[] = [
    {
        src: "/src/assets/adam.jpg",
        name: "Adam Psikut",
        company: "FatForLife.pl",
        paragraph:
            "Współpraca z firmą Betterize to była najlepsza decyzja jaką mogłem podjąć. Ich szybkość, profesjonalizm i elastyczność były nie do przecenienia. Polecam każdemu, kto szuka wysokiej jakości usług internetowych.",
    },
    {
        src: "/src/assets/guy.png",
        name: "Marek Pompa",
        company: "2gonecup.pl",
        paragraph:
            "Współpraca z firmą Betterize to była najlepsza decyzja jaką mogłem podjąć. Ich szybkość, profesjonalizm i elastyczność były nie do przecenienia. Polecam każdemu, kto szuka wysokiej jakości usług internetowych.",
    },
    {
        src: "/src/assets/profilowka.jpg",
        name: "Ignacy Trąbasz",
        company: "onliners.pl",
        paragraph:
            "Dzięki firmie Betterize, moja strona internetowa jest teraz piękna i funkcjonalna. Zespół był bardzo kreatywny i elastyczny w dostosowaniu się do moich potrzeb. Gorąco polecam ich usługi.",
    },
];

async function render_img_html(src: string) {
    const renderedHTML = await renderImg({
        src: src,
        alt: "Person",
        width: 400,
        height: 400,
        aspect: 1,
    });

    return renderedHTML;
}

async function processTestimonialsData() {
    const updatedTestimonialsData = await Promise.all(
        testimonialsData.map(async (testimonial) => {
            const renderedHTML = await render_img_html(testimonial.src);
            return {
                ...testimonial,
                src: renderedHTML,
            };
        })
    );

    return updatedTestimonialsData;
}

const testimonialsWithSrcAsImg = await processTestimonialsData().then(
    (updatedData) => updatedData
);
---

<Testimonials testimonials_data={testimonialsWithSrcAsImg} client:visible />
